<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lrc maker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet" />
    <style>
      * {
        user-select: none;
      }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              1: "#5A7D7C",
              2: "#DADFF7",
              3: "#232C33",
              4: "#A0C1D1",
              5: "#101316",
            },
          },
          fontFamily: {
            body: ["Lexend", "sans-serif"],
          },
        },
      };
    </script>
  </head>
  <body class="bg-5 font-body text-white">
    <!-- Header -->
    <nav class="shadow-sm bg-5 py-2 top-0 left-0 w-full sticky">
      <h1 class="text-3xl text-center text-white">.LRC MAKER</h1>
    </nav>
    <!-- .Header -->
    <!-- content -->
    <div id="main" class="w-full min-h-[85vh] flex">
      <!-- first page & dnd-->
      <section style="display: flex" id="greeting" class="flex min-h-[85vh] flex-col w-full h-full items-center justify-center space-y-2 ease-out">
        <div class="text-center">
          <h1 class="text-2xl">.LRC FILE MAKER</h1>
          <p class="text-xm">by Reazon</p>
        </div>
        <p>Mari mulai dengan memilih Audio</p>
        <button class="bg-1 py-1 px-2 rounded-md lrc-select-file cursor-pointer">pilih Audio</button>
        <p>atau drag & drop kesini.</p>
      </section>
      <!-- .first page & dnd -->

      <!-- property form -->
      <section style="display: none" id="property" class="flex flex-col w-full h-full justify-center p-5 gap-5 max-w-[60rem] mx-auto">
        <p>Edit deskripsi ini</p>
        <div class="flex flex-col gap-2">
          <div class="flex flex-col gap-2 w-full">
            <p class="text-lg">Judul</p>
            <input placeholder="judul" id="title" class="bg-3 py-2 px-3 rounded-md" type="text" />
          </div>
          <div class="flex items-center gap-2">
            <div class="flex flex-col gap-2 w-full">
              <p class="text-lg">Artis</p>
              <input placeholder="artis" id="artist" class="bg-3 py-2 px-3 rounded-md" type="text" />
            </div>
            <div class="flex flex-col gap-2 w-full">
              <p class="text-lg">Album</p>
              <input placeholder="album" id="album" class="bg-3 py-2 px-3 rounded-md" type="text" />
            </div>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex flex-col gap-2 w-full">
              <p class="text-lg">Author</p>
              <input placeholder="pembuat lagu" id="author" class="bg-3 py-2 px-3 rounded-md" type="text" />
            </div>
            <div class="flex flex-col gap-2 w-full">
              <p class="text-lg">Your Name</p>
              <input placeholder="kimi no namae" id="username" class="bg-3 py-2 px-3 rounded-md" type="text" />
            </div>
          </div>
          <p class="text-lg">Audio Terpilih</p>
          <div class="bg-1 flex items-center justify-center gap-2 p-2 rounded-lg lrc-select-file cursor-pointer">
            <svg width="12" height="16" viewBox="0 0 12 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M5.46975 0.248169H1.5C1.10218 0.248169 0.720644 0.406204 0.43934 0.687509C0.158035 0.968813 0 1.35034 0 1.74817V10.7482C0 11.146 0.158035 11.5275 0.43934 11.8088C0.720644 12.0901 1.10218 12.2482 1.5 12.2482H7.5C7.89782 12.2482 8.27936 12.0901 8.56066 11.8088C8.84196 11.5275 9 11.146 9 10.7482V3.77842C8.99996 3.57952 8.92091 3.38879 8.78025 3.24817L6 0.467919C5.85938 0.327257 5.66865 0.248211 5.46975 0.248169ZM5.625 2.87317V1.37317L7.875 3.62317H6.375C6.17609 3.62317 5.98532 3.54415 5.84467 3.4035C5.70402 3.26285 5.625 3.07208 5.625 2.87317ZM6.75 5.22817V6.54067L5.25 6.91567V9.62317C5.25 9.99442 5.02425 10.2854 4.7535 10.4654C4.4805 10.6477 4.12425 10.7482 3.75 10.7482C3.37575 10.7482 3.0195 10.6477 2.7465 10.4654C2.4765 10.2854 2.25 9.99442 2.25 9.62317C2.25 9.25192 2.47575 8.96092 2.7465 8.78092C3.0195 8.59867 3.37575 8.49817 3.75 8.49817C4.017 8.49817 4.275 8.54917 4.5 8.64517V5.41567C4.5 5.24847 4.55588 5.08607 4.65874 4.95426C4.76161 4.82245 4.90557 4.7288 5.06775 4.68817L5.81775 4.50067C5.92834 4.47297 6.04379 4.47084 6.15532 4.49445C6.26685 4.51806 6.37153 4.56678 6.46141 4.63692C6.55129 4.70706 6.62399 4.79676 6.674 4.89921C6.724 5.00166 6.75 5.11416 6.75 5.22817Z"
                fill="white" />
            </svg>
            <p class="text-white lrc-name">The Title of That Songs.mp3</p>
          </div>
          <p class="text-lg">Lirik</p>
          <textarea id="lyrics" placeholder="lirik" class="p-2 rounded-md bg-3 h-[30vh]" style="resize: none"></textarea>
          <br />
          <button class="bg-1 py-1 px-2 rounded-md" onclick="gotoPage(2)">Lanjutkan</button>
        </div>
        <!-- <span class="block h-24"></span> -->
      </section>
      <!-- .property form -->

      <!-- Lyrics editor  -->
      <section style="display: none" id="lyrics-editor" class="w-full flex-col">
        <div class="bg-1 px-3 py-2 w-full flex items-center gap-2">
          <p>klik waktu disamping lirik atau</p>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="hidden bi bi-box-arrow-up-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5" />
            <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stopwatch-fill" viewBox="0 0 16 16">
            <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07A7.001 7.001 0 0 0 8 16a7 7 0 0 0 5.29-11.584l.013-.012.354-.354.353.354a.5.5 0 1 0 .707-.707l-1.414-1.415a.5.5 0 1 0-.707.707l.354.354-.354.354-.012.012A6.97 6.97 0 0 0 9 2.071V1h.5a.5.5 0 0 0 0-1zm2 5.6V9a.5.5 0 0 1-.5.5H4.5a.5.5 0 0 1 0-1h3V5.6a.5.5 0 1 1 1 0" />
          </svg>
          <p>untuk mengubah waktu</p>
        </div>
        <table class="w-full border-collapse border border-slate-500">
          <thead>
            <tr>
              <th class="border border-slate-600 p-2" style="width: 120px">waktu</th>
              <th class="border border-slate-600 p-2">lirik</th>
            </tr>
          </thead>
          <tbody class="lrc_table_body"></tbody>
        </table>
      </section>
      <!-- .Lyrics editor  -->
    </div>
    <!-- .content -->

    <!-- footer & media player -->
    <div class="bottom-0 left-0 w-full sticky">
      <div class="flex items-end justify-between p-2 lrc-controler-mode" style="display: none">
        <!-- Offset -->
        <div class="flex flex-col items-center">
          <p>Offset (s)</p>
          <div class="flex rounded-md overflow-hidden">
            <button class="bg-1 p-2" onclick="document.getElementById('offset').value =+(Number(document.getElementById('offset').value) - 0.1).toFixed(1)">-</button>
            <input class="bg-3 p-2 w-16" type="number" id="offset" value="0" step="0.1" required />
            <button class="bg-1 p-2" onclick="document.getElementById('offset').value =+(Number(document.getElementById('offset').value) + 0.1).toFixed(1)">+</button>
          </div>
        </div>
        <!-- .Offset -->

        <div class="flex gap-2">
          <div class="flex flex-col space-y-2">
            <div id="save" class="p-3 flex justify-center bg-1 rounded-lg cursor-pointer">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save-fill" viewBox="0 0 16 16">
                <path d="M8.5 1.5A1.5 1.5 0 0 1 10 0h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h6c-.314.418-.5.937-.5 1.5v7.793L4.854 6.646a.5.5 0 1 0-.708.708l3.5 3.5a.5.5 0 0 0 .708 0l3.5-3.5a.5.5 0 0 0-.708-.708L8.5 9.293z" />
              </svg>
            </div>
            <div class="p-3 flex justify-center bg-1 rounded-lg cursor-pointer" onclick="gotoPage(1)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z" />
              </svg>
            </div>
          </div>
          <div id="stopwatch" class="p-5 bg-1 rounded-lg flex items-center justify-center cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-stopwatch-fill" viewBox="0 0 16 16">
              <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07A7.001 7.001 0 0 0 8 16a7 7 0 0 0 5.29-11.584l.013-.012.354-.354.353.354a.5.5 0 1 0 .707-.707l-1.414-1.415a.5.5 0 1 0-.707.707l.354.354-.354.354-.012.012A6.97 6.97 0 0 0 9 2.071V1h.5a.5.5 0 0 0 0-1zm2 5.6V9a.5.5 0 0 1-.5.5H4.5a.5.5 0 0 1 0-1h3V5.6a.5.5 0 1 1 1 0" />
            </svg>
          </div>
        </div>
      </div>
      <div class="flex flex-col p-5 bg-3">
        <!-- filename Display -->
        <div id="controler-filename" style="display: none" class="lrc-controler-mode bg-1 flex items-center justify-center gap-2 p-2 lrc-select-file cursor-pointer">
          <svg width="9" height="13" viewBox="0 0 9 13" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M5.46975 0.248169H1.5C1.10218 0.248169 0.720644 0.406204 0.43934 0.687509C0.158035 0.968813 0 1.35034 0 1.74817V10.7482C0 11.146 0.158035 11.5275 0.43934 11.8088C0.720644 12.0901 1.10218 12.2482 1.5 12.2482H7.5C7.89782 12.2482 8.27936 12.0901 8.56066 11.8088C8.84196 11.5275 9 11.146 9 10.7482V3.77842C8.99996 3.57952 8.92091 3.38879 8.78025 3.24817L6 0.467919C5.85938 0.327257 5.66865 0.248211 5.46975 0.248169ZM5.625 2.87317V1.37317L7.875 3.62317H6.375C6.17609 3.62317 5.98532 3.54415 5.84467 3.4035C5.70402 3.26285 5.625 3.07208 5.625 2.87317ZM6.75 5.22817V6.54067L5.25 6.91567V9.62317C5.25 9.99442 5.02425 10.2854 4.7535 10.4654C4.4805 10.6477 4.12425 10.7482 3.75 10.7482C3.37575 10.7482 3.0195 10.6477 2.7465 10.4654C2.4765 10.2854 2.25 9.99442 2.25 9.62317C2.25 9.25192 2.47575 8.96092 2.7465 8.78092C3.0195 8.59867 3.37575 8.49817 3.75 8.49817C4.017 8.49817 4.275 8.54917 4.5 8.64517V5.41567C4.5 5.24847 4.55588 5.08607 4.65874 4.95426C4.76161 4.82245 4.90557 4.7288 5.06775 4.68817L5.81775 4.50067C5.92834 4.47297 6.04379 4.47084 6.15532 4.49445C6.26685 4.51806 6.37153 4.56678 6.46141 4.63692C6.55129 4.70706 6.62399 4.79676 6.674 4.89921C6.724 5.00166 6.75 5.11416 6.75 5.22817Z"
              fill="white" />
          </svg>
          <p class="text-white lrc-name">The Title of That Songs.mp3</p>
        </div>
        <!-- .filename Display -->
        <!-- time bar -->
        <div class="flex flex-col mt-2">
          <div class="flex w-full h-2 bg-2 relative cursor-pointer" style="--w: 0%">
            <input progress type="range" class="absolute h-2 w-full opacity-0" id="time-range" min="0" value="0" max="100" />
            <div style="width: var(--w)" class="bg-1 h-full"></div>
          </div>
          <div class="flex justify-between">
            <p class="currentTime">00:00</p>
            <p class="endTime">00:00</p>
          </div>
        </div>
        <!-- .time bar -->
        <!-- controler -->
        <div class="flex items-center gap-5">
          <div class="flex items-center gap-2">
            <div id="rewind" class="cursor-pointer">
              <svg width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.6564 12.7431C13.4572 12.8571 13.2917 13.0218 13.1765 13.2204C13.0614 13.419 13.0007 13.6445 13.0007 13.8741C13.0007 14.1036 13.0614 14.3291 13.1765 14.5277C13.2917 14.7263 13.4572 14.891 13.6564 15.0051L23.9963 21.0046C24.8413 21.4953 25.9999 20.9347 25.9999 19.8736V7.87456C25.9999 6.81344 24.8413 6.25281 23.9963 6.74356L13.6564 12.7431Z" fill="white" />
                <path d="M0.656449 12.7431C0.457223 12.8571 0.291661 13.0218 0.176517 13.2204C0.0613725 13.419 0.000732422 13.6445 0.000732422 13.8741C0.000732422 14.1036 0.0613725 14.3291 0.176517 14.5277C0.291661 14.7263 0.457223 14.891 0.656449 15.0051L10.9963 21.0046C11.8413 21.4953 12.9999 20.9347 12.9999 19.8736V7.87456C12.9999 6.81344 11.8413 6.25281 10.9963 6.74356L0.656449 12.7431Z" fill="white" />
              </svg>
            </div>
            <div id="p-n-p" class="cursor-pointer">
              <svg class="play" width="31" height="31" viewBox="0 0 28 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.0906 17.4416L7.7746 25.7482C6.55966 26.4524 5.00049 25.5997 5.00049 24.18V7.56686C5.00049 6.14943 6.55741 5.29447 7.7746 6.00094L22.0906 14.3075C22.367 14.4653 22.5968 14.6934 22.7565 14.9686C22.9163 15.2438 23.0005 15.5563 23.0005 15.8746C23.0005 16.1928 22.9163 16.5054 22.7565 16.7806C22.5968 17.0558 22.367 17.2839 22.0906 17.4416Z" fill="white" />
              </svg>
              <svg class="pause hidden" xmlns="http://www.w3.org/2000/svg" width="31" height="31" fill="currentColor" viewBox="0 0 16 16">
                <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5" />
              </svg>
            </div>
            <div id="forward" class="cursor-pointer">
              <svg width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_290_263)">
                  <path d="M12.3442 12.7431C12.5435 12.8571 12.709 13.0218 12.8242 13.2204C12.9393 13.419 12.9999 13.6445 12.9999 13.8741C12.9999 14.1036 12.9393 14.3291 12.8242 14.5277C12.709 14.7263 12.5435 14.891 12.3442 15.0051L2.00436 21.0046C1.15936 21.4953 0.000732422 20.9347 0.000732422 19.8736V7.87456C0.000732422 6.81344 1.15936 6.25281 2.00436 6.74356L12.3442 12.7431Z" fill="white" />
                  <path d="M25.3442 12.7431C25.5435 12.8571 25.709 13.0218 25.8242 13.2204C25.9393 13.419 25.9999 13.6445 25.9999 13.8741C25.9999 14.1036 25.9393 14.3291 25.8242 14.5277C25.709 14.7263 25.5435 14.891 25.3442 15.0051L15.0044 21.0046C14.1594 21.4953 13.0007 20.9347 13.0007 19.8736V7.87456C13.0007 6.81344 14.1594 6.25281 15.0044 6.74356L25.3442 12.7431Z" fill="white" />
                </g>
                <defs>
                  <clipPath id="clip0_290_263">
                    <rect width="26" height="26" fill="white" transform="translate(0.000732422 0.874084)" />
                  </clipPath>
                </defs>
              </svg>
            </div>
          </div>
          <div class="flex items-center relative">
            <div class="lrc-volum cursor-pointer">
              <svg class="sound" width="27" height="28" viewBox="0 0 27 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.6113 21.6298C20.6313 20.6125 21.4403 19.4036 21.9917 18.0726C22.5431 16.7416 22.826 15.3148 22.8243 13.8741C22.826 12.4334 22.5431 11.0066 21.9917 9.67561C21.4403 8.34462 20.6313 7.13571 19.6113 6.11835L18.4182 7.31141C19.2816 8.17211 19.9662 9.19503 20.4328 10.3213C20.8993 11.4476 21.1386 12.655 21.1368 13.8741C21.139 15.0934 20.9001 16.301 20.4339 17.4276C19.9676 18.5542 19.2831 19.5774 18.4199 20.4385L19.6113 21.6298Z" fill="white" />
                <path
                  d="M17.225 19.2437C17.9302 18.5385 18.4895 17.7014 18.8712 16.7801C19.2528 15.8588 19.4492 14.8713 19.4492 13.8741C19.4492 12.8768 19.2528 11.8894 18.8712 10.9681C18.4895 10.0467 17.9302 9.20959 17.225 8.50444L16.032 9.69751C16.5804 10.246 17.0154 10.8971 17.3122 11.6138C17.609 12.3304 17.7617 13.0984 17.7617 13.8741C17.7617 14.6497 17.609 15.4178 17.3122 16.1344C17.0154 16.851 16.5804 17.5021 16.032 18.0506L17.225 19.2437ZM13.8669 6.36469C14.0099 6.43356 14.1305 6.54134 14.215 6.67566C14.2995 6.80998 14.3443 6.96539 14.3445 7.12407V20.6241C14.3443 20.7828 14.2992 20.9383 14.2146 21.0726C14.13 21.207 14.0092 21.3147 13.866 21.3834C13.7229 21.4522 13.5633 21.4791 13.4056 21.4612C13.2478 21.4433 13.0983 21.3813 12.9742 21.2822L8.98667 18.0928H5.06323C4.83946 18.0928 4.62484 18.0039 4.46661 17.8457C4.30838 17.6875 4.21948 17.4728 4.21948 17.2491V10.4991C4.21948 10.2753 4.30838 10.0607 4.46661 9.90245C4.62484 9.74421 4.83946 9.65532 5.06323 9.65532H8.98667L12.9742 6.46594C13.0984 6.3667 13.248 6.30454 13.406 6.28663C13.5639 6.26871 13.7237 6.29577 13.8669 6.36469Z"
                  fill="white" />
              </svg>
              <svg class="mute hidden" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16">
                <path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0" />
              </svg>
            </div>
            <div class="bg-3 p-2">
              <div class="flex w-24 h-2 bg-2 relative rounded-lg cursor-pointer" style="--w: 100%">
                <input progress type="range" class="absolute h-2 w-full opacity-0" id="volume-range" min="0" value="1" max="1" step="0.01" />

                <div style="width: var(--w)" class="bg-1 h-full mt-auto rounded-lg"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- .controler -->
    </div>
    <!-- .Footer & media player -->

    <div id="lrc">
      <!-- file input -->
      <input type="file" id="fileInput" accept="audio/*" hidden />
      <audio id="audioPlayer" hidden></audio>
      <!-- .file input -->
    </div>
    <script>
      // NOTE
      // its not pefect. i know,
      // but ist work. for me.
      //
      //

      // drag n drop variable
      const fileInput = document.querySelector("#fileInput");
      const audioPlayer = document.querySelector("audio");
      const mainElement = document.querySelector("#main");
      const dragZone = document.querySelector("#greeting");

      // player Variable
      const pnpButton = document.querySelector("#p-n-p");
      const forwardButton = document.querySelector("#forward");
      const rewindButton = document.querySelector("#rewind");
      const volumeButton = document.querySelector(".lrc-volume");
      const timeRange = document.querySelector("#time-range");
      const volumeRange = document.querySelector("#volume-range");
      const offsetTime = document.querySelector("#offset");

      let lyrics = [];
      let file_name = "";
      let lastLyricsSetIndex = 0;

      // audio property
      const lrc_title = document.querySelector("#title");
      const lrc_artist = document.querySelector("#artist");
      const lrc_album = document.querySelector("#album");
      const lrc_author = document.querySelector("#author");
      const lrc_userName = document.querySelector("#username");
      const lrc_lyrics = document.querySelector("#lyrics");

      const stopwatch = document.querySelector("#stopwatch");
      const saveButton = document.querySelector("#save");

      const table = document.querySelector(".lrc_table_body");

      const iterval = setInterval(function () {
        if (!(lyrics.length && lyrics.length > 0 && audioPlayer.src && !audioPlayer.paused)) return;
        updateTable();
      }, 200);

      // drag n drop and file select feature
      dragZone.addEventListener("dragover", function (event) {
        event.preventDefault();
        this.classList.add("bg-1/50");
      });

      dragZone.addEventListener("dragleave", function (event) {
        event.preventDefault();
        this.classList.remove("bg-1/50");
      });
      dragZone.addEventListener("drop", function (event) {
        event.preventDefault();
        this.classList.remove("bg-1/50");

        const file = event.dataTransfer.files[0];
        if (file && file.type.startsWith("audio/")) {
          loadAudio(file);
        } else alert("file type not supported");
      });

      document.querySelectorAll(`.lrc-select-file`).forEach(function (v) {
        v.addEventListener("click", function () {
          fileInput.click();
        });
      });

      const gotoPage = function (pageIndex) {
        const pages = ["greeting", "property", "lyrics-editor"];

        pages.forEach((v, i) => {
          if (i === pageIndex) document.getElementById(v).style.display = "flex";
          else document.getElementById(v).style.display = "none";
        });

        document.querySelectorAll(`.lrc-controler-mode`).forEach(function (v) {
          if (pageIndex === 2) v.style.display = "flex";
          else v.style.display = "none";
        });

        if (pageIndex === 2) {
          initLyrics();
          drawTable(true);
        }
      };

      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        console.log(file);
        if (file && file.type.startsWith("audio/")) {
          loadAudio(file);
        } else alert("file type not supported");
      });

      function loadAudio(file) {
        const url = URL.createObjectURL(file);
        audioPlayer.src = url;
        audioPlayer.preload = "auto";
        audioPlayer.onloadeddata = function () {
          gotoPage(1);
          document.querySelectorAll(`.lrc-name`).forEach(function (v) {
            v.innerHTML = file.name.split(".")[0];
          });

          file_name = file.name;

          document.querySelector(".endTime").innerHTML = timeFormat(audioPlayer.duration);
          timeRange.max = audioPlayer.duration;
        };
        audioPlayer.load();
      }

      // audio player controler

      document.querySelectorAll(`input[type="range"][progress]`).forEach(function (v) {
        v.addEventListener("input", function () {
          this.parentElement.style = `--w: ${(this.value / this.max) * 100}%`;
        });
      });

      function timeFormat(time, includes_milis) {
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60);
        const milliseconds = Math.floor(+(time % 1).toFixed(2) * 100);
        return `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}${includes_milis ? `.${String(milliseconds).padStart(2, "0")}` : ""}`;
      }

      function playAndPause() {
        if (!audioPlayer.src) return;
        if (audioPlayer.paused) {
          if (audioPlayer.currentTime >= audioPlayer.duration) audioPlayer.currentTime = 0;
          audioPlayer.play();
          pnpButton.querySelector(".play").classList.add("hidden");
          pnpButton.querySelector(".pause").classList.remove("hidden");
          return;
        }
        audioPlayer.pause();
        pnpButton.querySelector(".pause").classList.add("hidden");
        pnpButton.querySelector(".play").classList.remove("hidden");
        return;
      }

      pnpButton.addEventListener("click", playAndPause);
      volumeRange.addEventListener("input", function () {
        audioPlayer.volume = +this.value;
      });

      audioPlayer.addEventListener("timeupdate", function () {
        if (isNaN(audioPlayer.currentTime)) return;
        timeRange.value = audioPlayer.currentTime;
        timeRange.parentElement.style = `--w: ${(timeRange.value / timeRange.max) * 100}%`;

        document.querySelector(".currentTime").innerHTML = timeFormat(audioPlayer.currentTime, true);
        updateTable();
      });

      audioPlayer.addEventListener("ended", function () {
        if (!audioPlayer.paused) playAndPause();
        pnpButton.querySelector(".pause").classList.add("hidden");
        pnpButton.querySelector(".play").classList.remove("hidden");
      });

      timeRange.addEventListener("input", function () {
        audioPlayer.currentTime = this.value;
      });
      rewindButton.addEventListener("click", function () {
        audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 15);
      });
      forwardButton.addEventListener("click", function () {
        const crnt = audioPlayer.currentTime + 15;
        if (crnt < audioPlayer.duration) audioPlayer.currentTime = crnt;
        else audioPlayer.currentTime = audioPlayer.duration;
      });

      function convertTimeToSeconds(timeString) {
        const [minutes, rest] = timeString.split(":");
        const [seconds, milliseconds] = rest.split(".");
        return parseInt(minutes) * 60 + parseInt(seconds) + parseInt(milliseconds) / 100;
      }

      function getTimeFormat(str) {
        return str.substring(str.indexOf("[") + 1, str.indexOf("]")).trim();
      }

      function findCurrentLyricsIndex(time) {
        let index = null;

        for (let i = 0; i < lyrics.length; i++) {
          const timeA = convertTimeToSeconds(getTimeFormat(lyrics[i]));
          if (timeA < time && timeA !== 0) index = i;
        }

        return index;
      }

      function initLyrics() {
        if (!lrc_lyrics.value) return;
        lyrics = lrc_lyrics.value.split("\n");

        lyrics = lyrics.map(function (str, i) {
          if (!/^\[\d{1,3}:\d{1,3}\.\d{1,3}\]/.test(str)) return "[00:00.00]" + str;
          return str;
        });
        lrc_lyrics.value = lyrics.join("\n");
      }

      function setTimeLyrics(index, time) {
        if (lyrics[index - 1] && convertTimeToSeconds(getTimeFormat(lyrics[index - 1])) === 0) return;
        const formatedTime = timeFormat(time, true);
        const strTime = `[${formatedTime}]`;
        const str = lyrics[index].replace(/\[\d{1,3}:\d{1,3}\.\d{1,3}\]/, "");

        lyrics[index] = strTime + str;
        lrc_lyrics.value = lyrics.join("\n");

        lastLyricsSetIndex = index;
        document.querySelector(`.lrc-tr-table[data-id="${index}"] td:first-child`).innerHTML = formatedTime;
        updateTable();
        return formatedTime;
      }

      stopwatch.addEventListener("click", function () {
        if (lastLyricsSetIndex >= lyrics.length - 1) return;
        const currentTime = audioPlayer.currentTime;
        setTimeLyrics(lastLyricsSetIndex + 1, currentTime);
      });

      function updateTable() {
        const indexOfCurrentLyrics = findCurrentLyricsIndex(audioPlayer.currentTime);

        document.querySelectorAll(".lrc-tr-table").forEach(function (v) {
          if (parseInt(v.dataset.id) === indexOfCurrentLyrics) {
            if (!v.classList.contains("text-1")) v.classList.add("text-1");
            return;
          }
          if (v.classList.contains("text-1")) v.classList.remove("text-1");
        });
      }

      function create_trTable(id, time, text) {
        const tr = document.createElement("tr");
        tr.setAttribute("class", "odd:bg-1/10 even:bg-3/10 lrc-tr-table");
        tr.dataset.id = id;

        const td1 = document.createElement("td");
        td1.setAttribute("class", "border border-slate-600 p-2 text-center");
        td1.setAttribute("style", "width: 120px");
        td1.innerHTML = time;

        td1.onclick = function () {
          const currentTime = audioPlayer.currentTime;
          const offset = Number(offsetTime.value);

          setTimeLyrics(id, currentTime + offset);
        };
        const td2 = document.createElement("td");
        td2.innerHTML = text;
        td2.setAttribute("class", "border border-slate-600 p-2");

        tr.appendChild(td1);
        tr.appendChild(td2);
        return tr;
      }
      function drawTable() {
        table.innerHTML = "";
        lyrics.forEach(function (v, i) {
          table.appendChild(create_trTable(i, getTimeFormat(v), v.replace(/\[\d{1,3}:\d{1,3}\.\d{1,3}\]/, "")));
        });
      }

      saveButton.addEventListener("click", function () {
        const title = lrc_title.value;
        const artist = lrc_artist.value;
        const album = lrc_album.value;
        const author = lrc_author.value;
        const userName = lrc_userName.value;
        const fileName = artist && title ? `${title} - ${artist}.lrc` : file_name + ".lrc";

        const arr_str = [];

        if (title) arr_str.push(`[ti:${title}]`);
        if (artist) arr_str.push(`[ar:${artist}]`);
        if (album) arr_str.push(`[al:${album}]`);
        if (author) arr_str.push(`[au:${author}]`);
        if (userName) arr_str.push(`[by:${userName}]`);
        arr_str.push(`[tool: .LRC MAKER by reazon ${window.location.href}]`);
        arr_str.push(`[ve: 1.0]`);

        const blob = new Blob([`${arr_str.join("\n")}\n\n${lyrics.join("\n")}`], { type: "text/plain" });

        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = fileName;
        a.target = "_blank";
        a.click();
      });
    </script>
  </body>
</html>
